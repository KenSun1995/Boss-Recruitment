{"ast":null,"code":"import\"antd-mobile/es/grid/style\";import _Grid from\"antd-mobile/es/grid\";import\"antd-mobile/es/input-item/style\";import _InputItem from\"antd-mobile/es/input-item\";import\"antd-mobile/es/nav-bar/style\";import _NavBar from\"antd-mobile/es/nav-bar\";import\"antd-mobile/es/icon/style\";import _Icon from\"antd-mobile/es/icon\";import _classCallCheck from\"/Users/stewardsun/Desktop/\\u6280\\u672F\\u6808/React\\u9879\\u76EE/Boss Recruitment/bob-recruitment-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/stewardsun/Desktop/\\u6280\\u672F\\u6808/React\\u9879\\u76EE/Boss Recruitment/bob-recruitment-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/stewardsun/Desktop/\\u6280\\u672F\\u6808/React\\u9879\\u76EE/Boss Recruitment/bob-recruitment-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/stewardsun/Desktop/\\u6280\\u672F\\u6808/React\\u9879\\u76EE/Boss Recruitment/bob-recruitment-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import\"antd-mobile/es/list/style\";import _List from\"antd-mobile/es/list\";import React,{Component}from'react';import{connect}from'react-redux';import QueueAnim from'rc-queue-anim';import{sendMsg,readMsg}from'../../redux/actions';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Item=_List.Item;var Chat=/*#__PURE__*/function(_Component){_inherits(Chat,_Component);var _super=_createSuper(Chat);function Chat(){var _this;_classCallCheck(this,Chat);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={content:'',isShow:false// show emoji list or not\n};_this.handleSend=function(){var from=_this.props.user._id;var to=_this.props.match.params.userId;var content=_this.state.content.trim();// send request send msg\nif(content){_this.props.sendMsg({from:from,to:to,content:content});}// clear input data\n_this.setState({content:'',isShow:false});};_this.toggleShow=function(){var isShow=!_this.state.isShow;_this.setState({isShow:isShow});if(isShow){// fix bug, this bug is anti-mobile component internal bug, just fix it\nsetTimeout(function(){window.dispatchEvent(new Event('resize'));},0);}};return _this;}_createClass(Chat,[{key:\"componentDidMount\",value:function componentDidMount(){window.scrollTo(0,document.body.scrollHeight);}},{key:\"componentDidUpdate\",value:function componentDidUpdate(){window.scrollTo(0,document.body.scrollHeight);}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){// update un read msg\nvar targetId=this.props.match.params.userId;var userId=this.props.user._id;this.props.readMsg(targetId,userId);}// first render before\n},{key:\"UNSAFE_componentWillMount\",value:function UNSAFE_componentWillMount(){// init emoji list data\nvar emojis=['😀','😃','😄','😁','😆','😅','🤣','😂','🙂','🙃','😉','😊','😇','🥰','😍','🤩','😘','😗','😚','😙','🥲','😋','😛','😜','🤪','😝','🤑','🤗','🤭','🤫','🤔','🤐','🤨','😐','😑','😶','😶‍🌫️','😏','😒','🙄','😬','😮‍💨','🤥','😌','😔','😪','🤤','😴','😷','🤒','🤕','🤢','🤮','🤧','🥵','🥶'];this.emojis=emojis.map(function(emoji){return{text:emoji};});}},{key:\"render\",value:function render(){var _this2=this;var user=this.props.user;var _this$props$chat=this.props.chat,users=_this$props$chat.users,chatMsgs=_this$props$chat.chatMsgs;// filter chatMsgs\nvar my_id=user._id;if(!users[my_id]){// control async, async sometimes no data\nreturn null;}var target_id=this.props.match.params.userId;var chatId=[my_id,target_id].sort().join('_');var msgs=chatMsgs.filter(function(msg){return msg.chat_id===chatId;});// get target user header\nvar target_header=users[target_id].header;var target_icon=target_header?require(\"../../assets/img/\".concat(target_header,\".png\")).default:null;return/*#__PURE__*/_jsxs(\"div\",{id:\"chat-page\",children:[/*#__PURE__*/_jsx(_NavBar,{icon:/*#__PURE__*/_jsx(_Icon,{type:\"left\"}),className:\"sticky-header\",onLeftClick:function onLeftClick(){return _this2.props.history.goBack();},children:users[target_id].username}),/*#__PURE__*/_jsx(_List,{style:{marginTop:50,marginBottom:40},children:/*#__PURE__*/_jsx(QueueAnim,{type:\"left\",delay:100,children:msgs.map(function(msg){if(my_id===msg.to){// msg from the other\nreturn/*#__PURE__*/_jsx(Item,{thumb:target_icon,children:msg.content},msg._id);}else{return/*#__PURE__*/_jsx(Item,{className:\"chat-me\",extra:\"Me\",children:msg.content},msg._id);}})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"am-tab-bar\",children:[/*#__PURE__*/_jsx(_InputItem,{placeholder:\"Please input your words\",value:this.state.content,onChange:function onChange(val){return _this2.setState({content:val});},onFocus:function onFocus(){return _this2.setState({isShow:false});},extra:/*#__PURE__*/_jsxs(\"span\",{children:[/*#__PURE__*/_jsx(\"span\",{onClick:this.toggleShow,style:{marginRight:5},children:\"\\uD83D\\uDE00\"}),/*#__PURE__*/_jsx(\"span\",{onClick:this.handleSend,children:\"Send\"})]})}),this.state.isShow?/*#__PURE__*/_jsx(_Grid,{data:this.emojis,columnNum:8,carouselMaxRow:4,isCarousel:true,onClick:function onClick(item){_this2.setState({content:_this2.state.content+item.text});}}):null]})]});}}]);return Chat;}(Component);export default connect(function(state){return{user:state.user1,chat:state.chat1};},{sendMsg:sendMsg,readMsg:readMsg})(Chat);","map":{"version":3,"sources":["/Users/stewardsun/Desktop/技术栈/React项目/Boss Recruitment/bob-recruitment-client/src/containers/chat/chat.jsx"],"names":["React","Component","connect","QueueAnim","sendMsg","readMsg","Item","Chat","state","content","isShow","handleSend","from","props","user","_id","to","match","params","userId","trim","setState","toggleShow","setTimeout","window","dispatchEvent","Event","scrollTo","document","body","scrollHeight","targetId","emojis","map","emoji","text","chat","users","chatMsgs","my_id","target_id","chatId","sort","join","msgs","filter","msg","chat_id","target_header","header","target_icon","require","default","history","goBack","username","marginTop","marginBottom","val","marginRight","item","user1","chat1"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\nimport { NavBar, List, InputItem, Grid, Icon } from 'antd-mobile'\nimport { connect } from 'react-redux'\nimport QueueAnim from 'rc-queue-anim'\nimport { sendMsg, readMsg } from '../../redux/actions'\nconst Item = List.Item\nclass Chat extends Component {\n\n    state = {\n        content: '',\n        isShow: false // show emoji list or not\n    }\n\n    componentDidMount() {\n        window.scrollTo(0, document.body.scrollHeight);\n    }\n\n    componentDidUpdate() {\n        window.scrollTo(0, document.body.scrollHeight);\n    }\n\n    componentWillUnmount() {\n        // update un read msg\n        const targetId = this.props.match.params.userId;\n        const userId = this.props.user._id;\n        this.props.readMsg(targetId, userId);\n    }\n\n    // first render before\n    UNSAFE_componentWillMount() {\n        // init emoji list data\n        const emojis = [\n            '😀', '😃', '😄', '😁', '😆', '😅', '🤣', '😂',\n            '🙂', '🙃', '😉', '😊', '😇', '🥰', '😍', '🤩',\n            '😘', '😗', '😚', '😙', '🥲', '😋', '😛', '😜',\n            '🤪', '😝', '🤑', '🤗', '🤭', '🤫', '🤔', '🤐',\n            '🤨', '😐', '😑', '😶', '😶‍🌫️', '😏', '😒', '🙄',\n            '😬', '😮‍💨', '🤥', '😌', '😔', '😪', '🤤', '😴',\n            '😷', '🤒', '🤕', '🤢', '🤮', '🤧', '🥵', '🥶'];\n        this.emojis = emojis.map(emoji => ({ text: emoji }));\n    }\n\n    handleSend = () => {\n        const from = this.props.user._id;\n        const to = this.props.match.params.userId;\n        const content = this.state.content.trim();\n        // send request send msg\n        if (content) {\n            this.props.sendMsg({ from, to, content });\n        }\n        // clear input data\n        this.setState({ content: '', isShow: false });\n    }\n\n    toggleShow = () => {\n        const isShow = !this.state.isShow;\n        this.setState({ isShow });\n        if (isShow) {\n            // fix bug, this bug is anti-mobile component internal bug, just fix it\n            setTimeout(() => {\n                window.dispatchEvent(new Event('resize'))\n            }, 0)\n        }\n    }\n\n    render() {\n        const { user } = this.props;\n        const { users, chatMsgs } = this.props.chat;\n        // filter chatMsgs\n        const my_id = user._id;\n        if (!users[my_id]) { // control async, async sometimes no data\n            return null;\n        }\n        const target_id = this.props.match.params.userId;\n        const chatId = [my_id, target_id].sort().join('_');\n        const msgs = chatMsgs.filter(msg => msg.chat_id === chatId);\n\n        // get target user header\n        const target_header = users[target_id].header;\n        const target_icon = target_header ? require(`../../assets/img/${target_header}.png`).default : null;\n\n        return (\n            <div id='chat-page'>\n                <NavBar\n                    icon={<Icon type='left' />}\n                    className='sticky-header'\n                    onLeftClick={() => this.props.history.goBack()}\n                >\n                    {users[target_id].username}\n                </NavBar>\n                <List style={{ marginTop: 50, marginBottom: 40 }}>\n                    <QueueAnim type='left' delay={100}>\n                        {\n                            msgs.map(msg => {\n                                if (my_id === msg.to) { // msg from the other\n                                    return (\n                                        <Item key={msg._id} thumb={target_icon}>\n                                            {msg.content}\n                                        </Item>\n                                    )\n                                } else {\n                                    return (\n                                        <Item key={msg._id} className='chat-me' extra='Me'>\n                                            {msg.content}\n                                        </Item>\n                                    )\n                                }\n                            })\n                        }\n                    </QueueAnim>\n                </List>\n                <div className='am-tab-bar'>\n                    <InputItem\n                        placeholder=\"Please input your words\"\n                        value={this.state.content}\n                        onChange={val => this.setState({ content: val })}\n                        onFocus={() => this.setState({ isShow: false })}\n                        extra={\n                            <span>\n                                <span onClick={this.toggleShow} style={{ marginRight: 5 }}>😀</span>\n                                <span onClick={this.handleSend}>Send</span>\n                            </span>\n                        }\n                    />\n                    {this.state.isShow ? (\n                        <Grid\n                            data={this.emojis}\n                            columnNum={8}\n                            carouselMaxRow={4}\n                            isCarousel={true}\n                            onClick={(item) => {\n                                this.setState({ content: this.state.content + item.text })\n                            }}\n                        />\n                    ) : null}\n\n                </div>\n            </div>\n        )\n    }\n}\n\nexport default connect(\n    state => ({ user: state.user1, chat: state.chat1 }),\n    { sendMsg, readMsg }\n)(Chat)"]},"metadata":{},"sourceType":"module"}